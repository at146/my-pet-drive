<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MyPetDrive - Зоотакси в Москве</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/src/styles/drive.css" />
  </head>

  <body>
    <div class="container">
      <h1>Зоотакси MyPetDrive</h1>
      <!-- Telegram Auth Section -->
      <div id="telegram-auth-section">
        <h2>Авторизация через Telegram</h2>
        <p style="margin: 15px 0">Войдите через Telegram для создания заказа</p>
        <div id="telegram-login-container" style="margin: 20px 0"></div>
      </div>
      <!-- Main Order Form (hidden until auth) -->
      <div id="order-form" class="hidden">
        <!-- Progress Bar -->
        <div class="progress-bar">
          <div class="progress-step active" data-step="1">1. Маршрут</div>
          <div class="progress-step" data-step="2">2. Питомец</div>
          <div class="progress-step" data-step="3">3. Тариф</div>
          <div class="progress-step" data-step="4">4. Проверка</div>
          <div class="progress-step" data-step="5">Готово</div>
        </div>
        <!-- Step 1: Route -->
        <div class="step active" id="step-1">
          <h2>Шаг 1: Планирование маршрута</h2>
          <div class="form-group">
            <label>Откуда:</label>
            <input
              type="text"
              id="departure"
              placeholder="Москва, ул. Ленина, 10"
            />
            <button class="btn-secondary" onclick="getCurrentLocation()">
              Определить моё местоположение
            </button>
          </div>
          <div class="form-group">
            <label>Куда:</label>
            <input
              type="text"
              id="destination"
              placeholder="Москва, ул. Пушкина, 5"
            />
          </div>
          <button onclick="calculateRoute()" id="calc-route-btn">
            Рассчитать маршрут
          </button>
          <div id="map" class="hidden"></div>
          <div id="route-result" class="hidden result">
            <strong>Расстояние:</strong> <span id="distance">0</span> км
          </div>
          <div class="step-nav">
            <button onclick="goToStep(2)" id="next-to-step-2" disabled>
              Далее: Информация о питомце →
            </button>
          </div>
        </div>
        <!-- Step 2: Pet Info -->
        <div class="step" id="step-2">
          <h2>Шаг 2: Информация о питомце</h2>
          <div class="form-group">
            <label class="required-label">Вид животного</label>
            <select id="animal-type">
              <option value="">Выберите вид</option>
              <option value="Собака">Собака</option>
              <option value="Кошка">Кошка</option>
              <option value="Другой">Другое</option>
            </select>
          </div>
          <div class="form-group">
            <label>Порода (опционально):</label>
            <input type="text" id="breed" placeholder="Лабрадор" />
          </div>
          <div class="form-group">
            <label class="required-label">Вес (кг)</label>
            <input
              type="number"
              id="weight"
              min="0"
              step="0.5"
              placeholder="15"
            />
          </div>
          <div class="form-group">
            <label class="required-label">Дата поездки</label>
            <input type="date" id="trip-date" />
          </div>
          <div class="form-group">
            <label>Время:</label>
            <input type="time" id="trip-time" />
          </div>
          <div class="form-group">
            <label class="required-label">Телефон</label>
            <input type="tel" id="phone" placeholder="+7 (_) _--" />
          </div>
          <div class="step-nav">
            <button class="btn-back" onclick="goToStep(1)">← Назад</button>
            <button onclick="goToStep(3)" id="next-to-step-3" disabled>
              Далее: Выбор тарифа →
            </button>
          </div>
        </div>
        <!-- Step 3: Tariff -->
        <div class="step" id="step-3">
          <h2>Шаг 3: Выбор тарифа</h2>
          <p><strong>Расстояние:</strong> <span id="distance-3">0</span> км</p>
          <div class="tariff-cards">
            <div
              class="tariff-card"
              onclick="selectTariff('eco')"
              data-tariff="eco"
              id="tariff-eco"
            >
              <h3>ЭкоDelivery</h3>
              <p><strong>75₽/км</strong></p>
              <p>Выезд: 3-14 дней</p>
              <p style="margin-top: 10px; font-size: 18px; font-weight: 600">
                Средняя стоимость: <span class="eco-cost">0</span>₽
              </p>
            </div>
            <div
              class="tariff-card"
              onclick="selectTariff('opti')"
              data-tariff="opti"
              id="tariff-opti"
            >
              <h3>ОптиDelivery</h3>
              <p><strong>105₽/км</strong></p>
              <p>Выезд: в течение 1-2 дней</p>
              <p style="margin-top: 10px; font-size: 18px; font-weight: 600">
                Средняя стоимость: <span class="opti-cost">0</span>₽
              </p>
            </div>
            <div
              class="tariff-card"
              onclick="selectTariff('maxi')"
              data-tariff="maxi"
              id="tariff-maxi"
            >
              <h3>МаксиDelivery</h3>
              <p><strong>150₽/км</strong></p>
              <p>Выезд: 30 мин-8 часов</p>
              <p style="margin-top: 10px; font-size: 18px; font-weight: 600">
                Средняя стоимость: <span class="maxi-cost">0</span>₽
              </p>
            </div>
          </div>
          <div class="form-group">
            <label>Комментарий для водителя (опционально):</label>
            <textarea
              id="driver-comment"
              rows="3"
              placeholder="Укажите пожелания к поездке..."
            ></textarea>
            <div class="comment-suggestions">
              <button
                type="button"
                class="suggestion-btn"
                onclick="addCommentSuggestion('поездка с хозяином')"
              >
                поездка с хозяином
              </button>
              <button
                type="button"
                class="suggestion-btn"
                onclick="addCommentSuggestion('доставка до квартиры')"
              >
                доставка до квартиры
              </button>
              <button
                type="button"
                class="suggestion-btn"
                onclick="addCommentSuggestion('перенос вещей')"
              >
                перенос вещей
              </button>
              <button
                type="button"
                class="suggestion-btn"
                onclick="addCommentSuggestion('большой кузов')"
              >
                большой кузов
              </button>
            </div>
          </div>
          <div id="cost-display" class="result">
            <h3>Стоимость заказа</h3>
            <div id="short-distance-notice" class="hidden">
              <p style="color: #856404; font-weight: 600">
                ⚠ Подача на короткое расстояние
              </p>
              <p>
                Доплата за минимальную подачу:
                <span id="short-distance-fee">0</span>₽
              </p>
            </div>
            <p style="font-size: 18px">
              <strong>Прогноз стоимости:</strong> <span id="total-cost">0</span>₽
            </p>
            <p>
              Средняя стоимость: <span id="driver-cost">0</span>₽
            </p>
          </div>
          <div class="step-nav">
            <button class="btn-back" onclick="goToStep(2)">← Назад</button>
            <button onclick="goToStep(4)" id="next-to-step-4" disabled>
              Далее: Подтверждение →
            </button>
          </div>
        </div>
        <!-- Step 4: Confirmation -->
        <div class="step" id="step-4">
          <h2>Шаг 4: Подтверждение заказа</h2>
          <p style="margin-bottom: 20px">Проверьте данные перед отправкой</p>
          <div class="result">
            <p>
              <strong>Маршрут:</strong><br /><span id="summary-route"></span>
            </p>
            <p style="margin-top: 10px">
              <strong>Питомец:</strong><br /><span id="summary-pet"></span>
            </p>
            <p style="margin-top: 10px">
              <strong>Дата и время:</strong><br /><span
                id="summary-date"
              ></span>
            </p>
            <p
              style="margin-top: 10px"
              id="summary-comment-block"
              class="hidden"
            >
              <strong>Комментарий:</strong><br /><span
                id="summary-comment"
              ></span>
            </p>
            <p style="margin-top: 10px; font-size: 18px">
              <strong>Прогнозируемая цена:</strong> <span id="summary-cost"></span>₽
            </p>
          </div>
          <div class="checkbox-group">
            <input type="checkbox" id="consent-checkbox" />
            <label for="consent-checkbox"
              >Я даю согласие на обработку и публичное распространение моих
              персональных данных</label
            >
          </div>
          <div class="step-nav">
            <button class="btn-back" onclick="goToStep(3)">← Назад</button>
            <button onclick="submitOrder()" id="submit-btn" disabled>
              Оформить заказ
            </button>
          </div>
        </div>
        <!-- Step 5: Success -->
        <div class="step" id="step-5">
          <h2 style="text-align: center; color: #4caf50">
            ✓ Заказ успешно создан!
          </h2>
          <div class="result success">
            <h3 style="text-align: center; font-size: 24px">
              Номер заказа: <span id="order-code-display"></span>
            </h3>
            <p style="text-align: center; margin-top: 15px">
              Уведомления отправлены в Telegram
            </p>
            <p style="text-align: center">
              Ожидайте откликов водителей в течение 15 минут
            </p>
          </div>
          <div
            id="success-redirect"
            style="text-align: center; margin-top: 20px"
          >
            <p>
              Перенаправление на страницу заказа через
              <span id="countdown">5</span> секунд...
            </p>
            <button
              onclick="goToOrderPage()"
              style="width: 100%; margin-top: 10px"
            >
              Перейти к заказу
            </button>
          </div>
        </div>
      </div>
      <!-- Disclaimer -->
      <div class="disclaimer">
        <strong>Внимание:</strong> Текущая версия сервиса работоспособна,
        предназначена для коммерческого тестирования и демонстрации возможностей
        IT-решения. Оператор обязан настроить собственный источник данных и
        обеспечить защиту персональной информации в соответствии с 152-ФЗ.
      </div>
    </div>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script type="module" src="/src/scripts/drive.js"></script>
  </body>
</html>
